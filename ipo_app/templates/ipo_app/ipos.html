{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>All IPOs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
    <h2 class="mb-4 text-primary fw-bold">All IPOs</h2>

    <!-- Search Input -->
    <input type="text" id="searchInput" class="form-control mb-4" placeholder="Search IPO by company name">

    <!-- IPO List -->
    <div id="ipoContainer" class="row"></div>
</div>

<script>
  async function loadIPOs() {
    const response = await fetch("/admin_panel/api/ipos/");
    const ipos = await response.json();
    const container = document.getElementById("ipoContainer");
    const searchInput = document.getElementById("searchInput");

    function renderList(filteredIPOs) {
      container.innerHTML = "";
      if (filteredIPOs.length === 0) {
        container.innerHTML = "<p>No IPOs found.</p>";
      }
      filteredIPOs.forEach(ipo => {
        container.innerHTML += `
          <div class="col-md-6">
            <div class="card mb-3 shadow-sm">
              <div class="card-body">
                <h5 class="card-title">${ipo.company_name}</h5>
                <p class="card-text">
                  <strong>Price Band:</strong> ${ipo.price_band}<br>
                  <strong>Open:</strong> ${ipo.open_date} | <strong>Close:</strong> ${ipo.close_date}<br>
                  <strong>Listing Date:</strong> ${ipo.listing_date}<br>
                  <strong>Status:</strong> <span class="badge bg-info">${ipo.status}</span>
                </p>
              </div>
            </div>
          </div>
        `;
      });
    }

    renderList(ipos);

    searchInput.addEventListener("keyup", function () {
      const keyword = this.value.toLowerCase();
      const filtered = ipos.filter(ipo => ipo.company_name.toLowerCase().includes(keyword));
      renderList(filtered);
    });
  }

  loadIPOs();
</script>
</body>
</html>
